<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Analyzer - Speed Meter</title>
    <style>
        body { background-color: #050505; color: #00f2ff; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #canvas { border: 1px solid #111; margin-bottom: 20px; }
        .value { font-size: 3rem; font-weight: bold; margin: 10px 0; }
        .label { font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; opacity: 0.7; }
        .speed-meter { color: #00f2ff; font-size: 1.2rem; margin: 15px 0; padding: 10px; border: 1px solid #222; background: rgba(0, 242, 255, 0.05); }
        .critical { color: #ff0000 !important; text-shadow: 0 0 10px #ff0000; }
        button { background: none; border: 1px solid #00f2ff; color: #00f2ff; padding: 10px 20px; cursor: pointer; margin-top: 20px; font-family: inherit; }
    </style>
</head>
<body>
    <div class="label">State: <span id="state-val">Stable Scan</span></div>
    <canvas id="canvas" width="300" height="250"></canvas>
    <div id="display" class="value">0</div>
    <div class="label" id="odds-label">Odds: 1 in 1</div>
    
    <div class="speed-meter" id="speed-display">Rotation: 100%</div>
    
    <div style="font-size: 0.9rem; color: #555;">
        PEAK: <span id="peak-val">0</span> | ANOMALIES: <span id="anom-count">0</span>
    </div>
    <button onclick="resetSession()">NEW SESSION (RESET)</button>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let desviacion = 0, peak = 0, anomalies = 0, angulo = 0;
        let baseSpeed = 0.05; // MANTENEMOS TU VELOCIDAD ORIGINAL

        function update() {
            let random = Math.random() < 0.5 ? -1 : 1;
            desviacion += random;
            if (Math.abs(desviacion) > peak) peak = Math.abs(desviacion);
            
            const isCritical = Math.abs(desviacion) > 1500;
            const display = document.getElementById('display');
            
            if (isCritical) {
                display.classList.add('critical');
                document.getElementById('state-val').innerText = "CRITICAL ANOMALY";
                anomalies++;
            } else {
                display.classList.remove('critical');
                document.getElementById('state-val').innerText = "Stable Scan";
            }

            display.innerText = desviacion;
            document.getElementById('peak-val').innerText = peak;
            document.getElementById('anom-count').innerText = anomalies;
            
            // EL MEDIDOR DE VELOCIDAD EN TIEMPO REAL
            let currentSpeedPerc = (baseSpeed / 0.05) * 100;
            document.getElementById('speed-display').innerText = `Rotation: ${currentSpeedPerc.toFixed(1)}%`;

            let odds = Math.floor(Math.abs(desviacion) / 40) + 1;
            document.getElementById('odds-label').innerText = `Odds: 1 in ${odds}`;

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            angulo += baseSpeed;
            ctx.strokeStyle = Math.abs(desviacion) > 1500 ? '#ff0000' : '#00f2ff';
            [80, 55, 30].forEach((r, i) => {
                ctx.save();
                ctx.translate(150, 125);
                ctx.rotate(i % 2 === 0 ? angulo : -angulo);
                ctx.strokeRect(-r, -r, r * 2, r * 2);
                ctx.restore();
            });
        }

        function resetSession() { desviacion = 0; peak = 0; anomalies = 0; }
        update();
    </script>
</body>
</html>
